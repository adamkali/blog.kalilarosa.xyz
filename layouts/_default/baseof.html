<!DOCTYPE html>
<html lang="{{ or site.Language.LanguageCode site.Language.Lang }}" dir="{{ or site.Language.LanguageDirection `ltr` }}">
<head>
  {{ partial "head.html" . }}
  {{ partialCached "css.html" . }}
</head>
{{ $theme := "dark" }}
{{- with .Site.Params.theme }}
  {{ $theme = . }}
{{- end }}
<body class="min-h-screen text-lg relative">
  <main>
    {{ block "main" . }}{{ end }}
  </main>

  {{ if .Param "math" }}
    {{ partial "math.html" . }}
  {{ end }}
  
  <!-- Three.js for synthwave background - Load asynchronously for performance -->
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script async src="/synthwave-shader.js"></script>
  
  {{- if eq $theme "auto" }}
  <script>
    function detectThemePreferences() {
      let themeClasses = ["text-dark"];
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          themeClasses = ["text-light", "dark"];
      }
      document.body.classList.add(themeClasses);
    }

    detectThemePreferences();
  </script>
  {{- end }}
</body>
</html>
